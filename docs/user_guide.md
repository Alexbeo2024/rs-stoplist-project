# üìã **–†–£–ö–û–í–û–î–°–¢–í–û –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø**
## –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ Excel-—Ñ–∞–π–ª–æ–≤

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 30 —è–Ω–≤–∞—Ä—è 2025 –≥.
**–ê–≤—Ç–æ—Ä:** –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏

---

## üìñ **–°–û–î–ï–†–ñ–ê–ù–ò–ï**

1. [–í–≤–µ–¥–µ–Ω–∏–µ –∏ –æ–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–≤–≤–µ–¥–µ–Ω–∏–µ-–∏-–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∏-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
3. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
4. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ-—Å–∏—Å—Ç–µ–º—ã)
5. [–ó–∞–ø—É—Å–∫ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ](#–∑–∞–ø—É—Å–∫-–∏-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
6. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞)
7. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
8. [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#api-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
9. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å-–∏-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
10. [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)
11. [–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã](#—á–∞—Å—Ç–æ-–∑–∞–¥–∞–≤–∞–µ–º—ã–µ-–≤–æ–ø—Ä–æ—Å—ã)

---

## üìö **–í–í–ï–î–ï–ù–ò–ï –ò –û–ë–ó–û–† –°–ò–°–¢–ï–ú–´**

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ Excel-—Ñ–∞–π–ª–æ–≤ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è:

- üìß **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** –ø–æ—á—Ç–æ–≤—ã—Ö —è—â–∏–∫–æ–≤ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å Excel-–≤–ª–æ–∂–µ–Ω–∏—è–º–∏
- üìä **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏** .xlsx —Ñ–∞–π–ª–æ–≤ –≤ .csv —Ñ–æ—Ä–º–∞—Ç —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- üîÑ **–ü–µ—Ä–µ–¥–∞—á–∏** –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –Ω–∞ SFTP-—Å–µ—Ä–≤–µ—Ä
- üìà **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- üõ°Ô∏è **–û–±–µ—Å–ø–µ—á–µ–Ω–∏—è** –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç 24/7 –±–µ–∑ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚úÖ **–í—ã—Å–æ–∫–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
‚úÖ **Enterprise-level –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∑–∞—â–∏—Ç–∞ –æ—Ç DDoS, –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤, –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production deployment
‚úÖ **–ü–æ–ª–Ω–∞—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   üìß Email      ‚îÇ ‚îÄ‚îÄ‚ñ∂‚îÇ  üîÑ Processing  ‚îÇ ‚îÄ‚îÄ‚ñ∂‚îÇ  üì§ SFTP       ‚îÇ
‚îÇ   Server        ‚îÇ    ‚îÇ   Engine        ‚îÇ    ‚îÇ   Upload       ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ ‚Ä¢ IMAP/POP3     ‚îÇ    ‚îÇ ‚Ä¢ File          ‚îÇ    ‚îÇ ‚Ä¢ Validation    ‚îÇ
‚îÇ ‚Ä¢ Filtering     ‚îÇ    ‚îÇ   Conversion    ‚îÇ    ‚îÇ ‚Ä¢ Hash Check    ‚îÇ
‚îÇ ‚Ä¢ Deduplication ‚îÇ    ‚îÇ ‚Ä¢ Hash          ‚îÇ    ‚îÇ ‚Ä¢ Retry Logic   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ   Calculation   ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ ‚Ä¢ Database      ‚îÇ
                       ‚îÇ   Logging       ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ  üìä Monitoring  ‚îÇ
                       ‚îÇ                 ‚îÇ
                       ‚îÇ ‚Ä¢ Health Checks ‚îÇ
                       ‚îÇ ‚Ä¢ Metrics       ‚îÇ
                       ‚îÇ ‚Ä¢ Alerting      ‚îÇ
                       ‚îÇ ‚Ä¢ Rate Limiting ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üèóÔ∏è **–ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ò –ö–û–ú–ü–û–ù–ï–ù–¢–´**

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

#### 1. **Email Processing Module** üìß
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—á—Ç–æ–≤—ã—Ö —è—â–∏–∫–æ–≤ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–∏–π
- **–§—É–Ω–∫—Ü–∏–∏:**
  - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ IMAP/POP3 —Å–µ—Ä–≤–µ—Ä–∞–º
  - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ whitelist –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ–π
  - –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ Message-ID
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–ª—å–∫–æ .xlsx –≤–ª–æ–∂–µ–Ω–∏–π
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª:** –ö–∞–∂–¥—ã–π —á–∞—Å (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

#### 2. **File Processing Engine** üîÑ
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤
- **–§—É–Ω–∫—Ü–∏–∏:**
  - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è .xlsx ‚Üí .csv (UTF-8 with BOM)
  - –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ö–µ—à-—Å—É–º–º (SHA256)
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–∞–ø–æ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ
  - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤
- **–í—ã—Ö–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–∞—Ç:** `RS_stoplist_{YYYYMMDD}.csv`

#### 3. **SFTP Upload Service** üì§
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Ñ–∞–π–ª–æ–≤
- **–§—É–Ω–∫—Ü–∏–∏:**
  - Key-based –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
  - Retry –ª–æ–≥–∏–∫–∞ —Å exponential backoff
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

#### 4. **Database Layer** üóÑÔ∏è
- **–°–£–ë–î:** PostgreSQL 15+
- **–¢–∞–±–ª–∏—Ü—ã:**
  - `processed_files` - —É—á–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
  - `operation_logs` - –ª–æ–≥–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–§—É–Ω–∫—Ü–∏–∏:** ACID-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å, –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ, backup

#### 5. **Monitoring & Alerting** üìä
- **Health Checks:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **Metrics:** Prometheus-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- **Notifications:** Email + Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **Rate Limiting:** –ó–∞—â–∏—Ç–∞ –æ—Ç DDoS –∞—Ç–∞–∫

#### 6. **Security Layer** üõ°Ô∏è
- **Circuit Breaker:** –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤
- **Error Categorization:** CRITICAL/RECOVERABLE/WARNING
- **Graceful Degradation:** 4 —É—Ä–æ–≤–Ω—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–∞
- **Authentication:** Key-based –¥–æ—Å—Ç—É–ø –∫ SFTP

---

## üöÄ **–£–°–¢–ê–ù–û–í–ö–ê –ò –ù–ê–°–¢–†–û–ô–ö–ê**

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

#### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- **–û–°:** Linux (Ubuntu 20.04+), macOS, Windows 10+
- **RAM:** 2 GB
- **CPU:** 2 cores
- **–î–∏—Å–∫:** 10 GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- **Docker:** 20.10+
- **Docker Compose:** 2.0+

#### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (Production):
- **–û–°:** Ubuntu 22.04 LTS –∏–ª–∏ CentOS 8+
- **RAM:** 8 GB
- **CPU:** 4 cores
- **–î–∏—Å–∫:** 50 GB SSD
- **–°–µ—Ç—å:** –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- **Backup:** –†–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü–æ—à–∞–≥–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

#### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/your-org/rs-stoplist-project.git
cd rs-stoplist-project

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker
docker --version
docker-compose --version

# 3. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
mkdir -p storage/sftp_upload
mkdir -p logs
mkdir -p data/postgres
```

#### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –∫–ª—é—á–µ–π

```bash
# 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSH –∫–ª—é—á–µ–π –¥–ª—è SFTP (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
ssh-keygen -t rsa -b 4096 -f ~/.ssh/sftp_key -N ""

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª—é—á–µ–π
ls -la ~/.ssh/

# 3. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π –≤ –ø—Ä–æ–µ–∫—Ç (–¥–ª—è development)
cp ~/.ssh/id_rsa ~/.ssh/sftp_key  # –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
cp ~/.ssh/id_rsa.pub ~/.ssh/sftp_key.pub  # –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
```

#### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
cp .env.example .env  # –µ—Å–ª–∏ –µ—Å—Ç—å —à–∞–±–ª–æ–Ω
# –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é:
touch .env
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ .env —Ñ–∞–π–ª–∞:**

```bash
# =====================================
# Database Configuration
# =====================================
POSTGRES_HOST=db
POSTGRES_PORT=5432
POSTGRES_USER=emailprocessor
POSTGRES_PASSWORD=secure_password_123
POSTGRES_DB=email_processor_db

# =====================================
# Email Configuration
# =====================================
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-app-specific-password

# =====================================
# SFTP Configuration
# =====================================
SFTP_HOST=sftp
SFTP_USER=sftpuser
SFTP_PASS=pass

# =====================================
# Notifications
# =====================================
TG_BOT_TOKEN=your-telegram-bot-token
TG_CHAT_ID=your-telegram-chat-id

# =====================================
# Security & Performance
# =====================================
SECRET_KEY=your-super-secret-key-here
ENVIRONMENT=development
DEBUG=false
```

#### –®–∞–≥ 4: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

```bash
# 1. –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps

# 3. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f app

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ health checks
curl http://localhost:8000/health/ready
```

---

## ‚öôÔ∏è **–ö–û–ù–§–ò–ì–£–†–ò–†–û–í–ê–ù–ò–ï –°–ò–°–¢–ï–ú–´**

### –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª

–§–∞–π–ª `config/config.yaml` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã:

```yaml
# =====================================
# Email Configuration
# =====================================
email:
  server: "imap.gmail.com"           # IMAP server
  port: 993                          # IMAP port (–æ–±—ã—á–Ω–æ 993 –¥–ª—è SSL)
  username: "${EMAIL_USER}"          # –ò–∑ .env —Ñ–∞–π–ª–∞
  password: "${EMAIL_PASS}"          # App-specific password
  allowed_senders:                   # Whitelist –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ–π
    - "reports@company.com"
    - "analytics@partner.org"
    - "data@supplier.net"

# =====================================
# Database Configuration
# =====================================
database:
  host: "${POSTGRES_HOST}"
  port: "${POSTGRES_PORT}"
  user: "${POSTGRES_USER}"
  password: "${POSTGRES_PASSWORD}"
  name: "${POSTGRES_DB}"
  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  pool_size: 20                      # –†–∞–∑–º–µ—Ä connection pool
  max_overflow: 30                   # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ
  pool_timeout: 30                   # –¢–∞–π–º–∞—É—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
  pool_recycle: 3600                 # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

# =====================================
# SFTP Configuration
# =====================================
sftp:
  host: "${SFTP_HOST}"
  username: "${SFTP_USER}"
  key_path: "/root/.ssh/id_rsa"      # –ü—É—Ç—å –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–ª—é—á—É
  remote_path: "/upload/directory"    # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–∞ SFTP —Å–µ—Ä–≤–µ—Ä–µ
  timeout: 30                        # –¢–∞–π–º–∞—É—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
  max_retries: 3                     # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

# =====================================
# Notifications Configuration
# =====================================
notifications:
  email:
    smtp_server: "smtp.gmail.com"
    smtp_port: 587
    username: "${EMAIL_USER}"
    password: "${EMAIL_PASS}"
    use_tls: true
    recipients:
      - "admin@company.com"
      - "ops@company.com"
  telegram:
    bot_token: "${TG_BOT_TOKEN}"
    chat_id: "${TG_CHAT_ID}"
    enable_notifications: true

# =====================================
# Scheduler Configuration
# =====================================
scheduler:
  interval_hours: 1                  # –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—á—Ç—ã (—á–∞—Å—ã)
  timezone: "UTC"                    # –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞
  max_concurrent_jobs: 1             # –ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
  misfire_grace_time: 300            # –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á

# =====================================
# File Processing Configuration
# =====================================
file_processing:
  max_file_size_mb: 50               # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
  temp_directory: "/tmp/processing"   # –í—Ä–µ–º–µ–Ω–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
  csv_encoding: "utf-8-sig"          # –ö–æ–¥–∏—Ä–æ–≤–∫–∞ CSV (UTF-8 with BOM)
  csv_separator: ","                 # –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å CSV
  cleanup_temp_files: true           # –£–¥–∞–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

# =====================================
# Logging Configuration
# =====================================
logging:
  config_file: "config/logging.yaml"
  log_to_file: true
  log_level: "INFO"                  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  max_log_size_mb: 10               # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ª–æ–≥-—Ñ–∞–π–ª–∞
  backup_count: 5                    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ backup —Ñ–∞–π–ª–æ–≤
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–§–∞–π–ª `config/logging.yaml`:

```yaml
version: 1
disable_existing_loggers: false

formatters:
  standard:
    format: "%(asctime)s [%(levelname)s] %(name)s: %(message)s"
    datefmt: "%Y-%m-%d %H:%M:%S"

  detailed:
    format: "%(asctime)s [%(levelname)s] %(name)s:%(lineno)d: %(message)s [%(pathname)s]"
    datefmt: "%Y-%m-%d %H:%M:%S"

  json:
    format: '{"time": "%(asctime)s", "level": "%(levelname)s", "logger": "%(name)s", "message": "%(message)s", "module": "%(module)s", "line": %(lineno)d}'

handlers:
  console:
    class: logging.StreamHandler
    level: INFO
    formatter: standard
    stream: ext://sys.stdout

  file:
    class: logging.handlers.RotatingFileHandler
    level: DEBUG
    formatter: detailed
    filename: logs/app.log
    maxBytes: 10485760  # 10MB
    backupCount: 5
    encoding: utf8

  error_file:
    class: logging.handlers.RotatingFileHandler
    level: ERROR
    formatter: json
    filename: logs/errors.log
    maxBytes: 10485760  # 10MB
    backupCount: 10
    encoding: utf8

loggers:
  src:
    level: DEBUG
    handlers: [console, file, error_file]
    propagate: false

  uvicorn:
    level: INFO
    handlers: [console, file]
    propagate: false

  sqlalchemy:
    level: WARNING
    handlers: [file]
    propagate: false

root:
  level: INFO
  handlers: [console, file]
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Gmail App Password:**
   ```
   1. –ò–¥–∏—Ç–µ –≤ Google Account settings
   2. Security ‚Üí 2-Step Verification
   3. App passwords ‚Üí Generate new password
   4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–∞—Ä–æ–ª—å –≤ EMAIL_PASS
   ```

2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ email:**
   ```bash
   # –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
   curl -X POST http://localhost:8000/api/test/email-notification
   ```

#### Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

1. **–°–æ–∑–¥–∞–Ω–∏–µ Telegram –±–æ—Ç–∞:**
   ```
   1. –ù–∞–π–¥–∏—Ç–µ @BotFather –≤ Telegram
   2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ /newbot
   3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
   4. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
   ```

2. **–ü–æ–ª—É—á–µ–Ω–∏–µ Chat ID:**
   ```
   1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É/–∫–∞–Ω–∞–ª
   2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É
   3. GET https://api.telegram.org/bot<TOKEN>/getUpdates
   4. –ù–∞–π–¥–∏—Ç–µ chat_id –≤ –æ—Ç–≤–µ—Ç–µ
   ```

---

## üéõÔ∏è **–ó–ê–ü–£–°–ö –ò –£–ü–†–ê–í–õ–ï–ù–ò–ï**

### –ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞

#### Development —Ä–µ–∂–∏–º:

```bash
# –ó–∞–ø—É—Å–∫ —Å –≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose up app

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f app
```

#### Production —Ä–µ–∂–∏–º:

```bash
# –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose restart app

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –±–µ–∑ downtime
docker-compose up -d --no-deps app
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º

#### –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker-compose config

# 2. –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤ (–µ—Å–ª–∏ –∏–∑–º–µ–Ω—è–ª—Å—è –∫–æ–¥)
docker-compose build

# 3. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
curl http://localhost:8000/health/ready
```

#### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã:

```bash
# Graceful –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose stop

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose kill

# –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (–í–ù–ò–ú–ê–ù–ò–ï: —É–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ!)
docker-compose down -v
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:

```bash
# 1. –°–æ–∑–¥–∞–Ω–∏–µ backup
docker-compose exec db pg_dump -U $POSTGRES_USER $POSTGRES_DB > backup.sql

# 2. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose stop app

# 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
git pull origin main

# 4. –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker-compose build app

# 5. –ó–∞–ø—É—Å–∫ —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π
docker-compose up -d app
```

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:

```bash
# –ó–∞–ø—É—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose up -d --scale app=3

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤
docker-compose ps app
```

#### Load Balancer –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

```yaml
# docker-compose.prod.yml
version: "3.8"
services:
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - app

  app:
    deploy:
      replicas: 3
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
```

---

## üìä **–ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê**

### Health Checks

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è:

#### 1. **Liveness Probe** (`/health/live`)
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∂–∏–≤–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞
curl -I http://localhost:8000/health/live

# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
HTTP/1.1 204 No Content
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** Kubernetes liveness probe
**–ß–∞—Å—Ç–æ—Ç–∞:** –ö–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥

#### 2. **Readiness Probe** (`/health/ready`)
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–æ–≤
curl -I http://localhost:8000/health/ready

# –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:
HTTP/1.1 204 No Content

# –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏:
HTTP/1.1 503 Service Unavailable
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
**–ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- PostgreSQL database connection
- SFTP server accessibility
- Email server connectivity
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** Kubernetes readiness probe
**–ß–∞—Å—Ç–æ—Ç–∞:** –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥

#### 3. **Detailed Health Check** (`/health/detailed`)
```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
curl http://localhost:8000/health/detailed

# –ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞:
{
  "status": "healthy",
  "checked_at": "2025-01-30T12:00:00Z",
  "dependencies": {
    "database": {
      "status": "healthy",
      "response_time_ms": 15,
      "details": "Connection successful"
    },
    "sftp": {
      "status": "healthy",
      "response_time_ms": 120,
      "details": "Authentication successful"
    },
    "email": {
      "status": "healthy",
      "response_time_ms": 230,
      "details": "IMAP connection successful"
    }
  },
  "total_response_time_ms": 365
}
```

### Prometheus –ú–µ—Ç—Ä–∏–∫–∏

–°–∏—Å—Ç–µ–º–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç comprehensive –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus:

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫:
```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫
curl http://localhost:8000/metrics

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É –º–µ—Ç—Ä–∏–∫–∏
curl http://localhost:8000/metrics | grep emails_processed_total
```

#### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:

**1. –°—á–µ—Ç—á–∏–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π:**
```
# –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ email
emails_processed_total{status="success",sender_domain="company.com"} 150

# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
files_converted_total{size_category="small"} 45
files_converted_total{size_category="medium"} 12
files_converted_total{size_category="large"} 3

# SFTP –∑–∞–≥—Ä—É–∑–∫–∏
sftp_uploads_total{status="success",validated="true"} 58
sftp_uploads_total{status="failed",validated="false"} 2
```

**2. –û—à–∏–±–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:**
```
# –û—à–∏–±–∫–∏ –ø–æ —Ç–∏–ø–∞–º
errors_by_type_total{error_type="ConnectionTimeout",component="email",severity="recoverable"} 5
errors_by_type_total{error_type="FileCorruption",component="processing",severity="recoverable"} 2
errors_by_type_total{error_type="SFTPAuthError",component="sftp",severity="critical"} 0
```

**3. –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã):**
```
# –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
processing_duration_seconds_bucket{operation="file_conversion",le="1.0"} 45
processing_duration_seconds_bucket{operation="file_conversion",le="5.0"} 58
processing_duration_seconds_bucket{operation="file_conversion",le="10.0"} 60

# Health check –≤—Ä–µ–º–µ–Ω–∞
health_check_duration_seconds_bucket{dependency="database",le="0.1"} 120
health_check_duration_seconds_bucket{dependency="sftp",le="1.0"} 118
```

**4. Gauge –º–µ—Ç—Ä–∏–∫–∏:**
```
# –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
active_processing_jobs 1

# –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ email
email_queue_size 3

# –ü–æ—Å–ª–µ–¥–Ω—è—è —É—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (Unix timestamp)
last_successful_processing_timestamp 1706616000
```

**5. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
```
# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
app_info{version="1.0.0",environment="production"} 1
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Grafana

#### Dashboard –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

**Panel 1: Email Processing Rate**
```json
{
  "title": "Email Processing Rate",
  "type": "graph",
  "targets": [
    {
      "expr": "rate(emails_processed_total[5m])",
      "legendFormat": "{{status}} emails/sec"
    }
  ]
}
```

**Panel 2: Error Rate by Component**
```json
{
  "title": "Error Rate by Component",
  "type": "graph",
  "targets": [
    {
      "expr": "rate(errors_by_type_total[5m])",
      "legendFormat": "{{component}}: {{error_type}}"
    }
  ]
}
```

**Panel 3: System Health Status**
```json
{
  "title": "System Health",
  "type": "stat",
  "targets": [
    {
      "expr": "up{job=\"email-processor\"}",
      "legendFormat": "Service Up"
    }
  ]
}
```

### –õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤:

**1. Application Logs** (`logs/app.log`):
```
2025-01-30 12:00:15 [INFO] email_reader: Starting email check cycle
2025-01-30 12:00:16 [INFO] email_reader: Found 3 new emails from allowed senders
2025-01-30 12:00:17 [INFO] file_processor: Processing file: report_20250130.xlsx (2.1MB)
2025-01-30 12:00:18 [INFO] file_processor: Converted to CSV: 1,245 rows exported
2025-01-30 12:00:19 [INFO] sftp_uploader: File uploaded and validated: RS_stoplist_20250130.csv
```

**2. Error Logs** (`logs/errors.log`):
```json
{
  "time": "2025-01-30 12:05:23",
  "level": "ERROR",
  "logger": "sftp_uploader",
  "message": "SFTP connection failed: Connection timeout",
  "module": "sftp_uploader",
  "line": 156,
  "error_type": "ConnectionTimeout",
  "retry_attempt": 2,
  "max_retries": 3
}
```

**3. Performance Logs** (`logs/performance.log`):
```json
{
  "time": "2025-01-30 12:00:20",
  "operation": "email_to_sftp_pipeline",
  "duration_ms": 4250,
  "file_size_mb": 2.1,
  "csv_rows": 1245,
  "status": "success"
}
```

#### Log Analysis Commands:

```bash
# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
docker-compose exec app tail -f logs/errors.log | grep "$(date -d '1 hour ago' '+%Y-%m-%d %H')"

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ–ø–µ—Ä–∞—Ü–∏—è–º
grep "operation_completed" logs/app.log | awk '{print $5}' | sort | uniq -c

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
tail -f logs/performance.log | jq -r '[.operation, .duration_ms] | @tsv'

# –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –ø–æ —Ç–∏–ø–∞–º
grep ERROR logs/errors.log | jq -r .error_type | sort | uniq -c | sort -nr
```

---

## üö® **–û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö**

–°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç enterprise-level —Å–∏—Å—Ç–µ–º—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–µ–π –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º.

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—à–∏–±–æ–∫

#### 1. **CRITICAL Errors** üî¥
–¢—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É:

```yaml
–¢–∏–ø—ã:
  - DatabaseConnectionError: –ü–æ—Ç–µ—Ä—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î
  - SFTPAuthenticationError: –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ SFTP
  - ConfigurationError: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  - PermissionError: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º

–î–µ–π—Å—Ç–≤–∏—è —Å–∏—Å—Ç–µ–º—ã:
  - –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
  - –û—Ç–ø—Ä–∞–≤–∫–∞ CRITICAL —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
  - –õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
  - –ê–∫—Ç–∏–≤–∞—Ü–∏—è Circuit Breaker
```

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞ CRITICAL –æ—à–∏–±–∫–∏:**
```json
{
  "timestamp": "2025-01-30T12:05:00Z",
  "level": "CRITICAL",
  "error_type": "DatabaseConnectionError",
  "component": "database",
  "message": "Failed to connect to PostgreSQL after 3 attempts",
  "context": {
    "host": "db",
    "port": 5432,
    "last_error": "connection refused",
    "retry_attempts": 3
  },
  "action_taken": "Circuit breaker opened, processing stopped"
}
```

#### 2. **RECOVERABLE Errors** üü°
–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å retry –ª–æ–≥–∏–∫–æ–π:

```yaml
–¢–∏–ø—ã:
  - EmailConnectionTimeout: –í—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å email
  - FileCorruptionError: –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
  - SFTPTransferError: –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–±–æ–∏ –ø–µ—Ä–µ–¥–∞—á–∏
  - OSError: –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ –æ—à–∏–±–∫–∏

Retry –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
  - EmailConnectionTimeout: 3 –ø–æ–ø—ã—Ç–∫–∏, 30 —Å–µ–∫ delay
  - SFTPTransferError: 3 –ø–æ–ø—ã—Ç–∫–∏, 30 —Å–µ–∫ delay
  - FileCorruptionError: 1 –ø–æ–ø—ã—Ç–∫–∞, 5 —Å–µ–∫ delay
  - OSError: 2 –ø–æ–ø—ã—Ç–∫–∏, 5 —Å–µ–∫ delay

Escalation:
  - –ü–æ—Å–ª–µ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è –ø–æ–ø—ã—Ç–æ–∫ ‚Üí CRITICAL
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ escalation
```

**–ü—Ä–∏–º–µ—Ä retry –ª–æ–≥–∏–∫–∏:**
```json
{
  "timestamp": "2025-01-30T12:03:15Z",
  "level": "WARNING",
  "error_type": "SFTPTransferError",
  "message": "SFTP transfer failed, attempting retry",
  "attempt": 2,
  "max_attempts": 3,
  "next_retry_in_seconds": 60,
  "exponential_backoff": true
}
```

#### 3. **WARNING Errors** üü†
–õ–æ–≥–≥–∏—Ä—É—é—Ç—Å—è –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏:

```yaml
–¢–∏–ø—ã:
  - FileNotFoundError: –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω (–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è)
  - ValidationError: –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  - EmailFilterError: Email –Ω–µ –ø—Ä–æ—à–µ–ª —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é

–î–µ–π—Å—Ç–≤–∏—è:
  - –õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
  - –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
  - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ summary –æ—Ç—á–µ—Ç—ã
```

### Circuit Breaker Pattern

–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:

#### –°–æ—Å—Ç–æ—è–Ω–∏—è Circuit Breaker:

**1. CLOSED (–ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞):**
```
- –í—Å–µ –≤—ã–∑–æ–≤—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –∫ —Å–µ—Ä–≤–∏—Å—É
- –°—á–µ—Ç—á–∏–∫ —Å–±–æ–µ–≤ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
- –ü–µ—Ä–µ—Ö–æ–¥ –≤ OPEN –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ failure_threshold
```

**2. OPEN (–°–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω):**
```
- –í—Å–µ –≤—ã–∑–æ–≤—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è CircuitBreakerOpenError
- –ü–µ—Ä–µ—Ö–æ–¥ –≤ HALF_OPEN –ø–æ—Å–ª–µ recovery_timeout
```

**3. HALF_OPEN (–ü—Ä–æ–±–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ):**
```
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–±–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
- –ü—Ä–∏ —É—Å–ø–µ—Ö–µ ‚Üí CLOSED
- –ü—Ä–∏ —Å–±–æ–µ ‚Üí –æ–±—Ä–∞—Ç–Ω–æ –≤ OPEN
```

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Circuit Breaker:

```python
# –î–ª—è SFTP —Å–µ—Ä–≤–∏—Å–∞
SFTP_CIRCUIT_BREAKER = {
    "failure_threshold": 5,      # —Å–±–æ–µ–≤ –¥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è
    "recovery_timeout": 60.0,    # —Å–µ–∫—É–Ω–¥ –¥–æ –ø—Ä–æ–±–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞
    "success_threshold": 2,      # —É—Å–ø–µ—Ö–æ–≤ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è
    "timeout": 30.0             # —Ç–∞–π–º–∞—É—Ç –≤—ã–∑–æ–≤–∞
}

# –î–ª—è Email —Å–µ—Ä–≤–∏—Å–∞
EMAIL_CIRCUIT_BREAKER = {
    "failure_threshold": 3,
    "recovery_timeout": 120.0,
    "success_threshold": 1,
    "timeout": 45.0
}
```

### Graceful Degradation

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Å–±–æ—è—Ö:

#### –£—Ä–æ–≤–Ω–∏ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏:

**1. FULL_SERVICE:**
```
- –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- –ü–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ SLA —Å–æ–±–ª—é–¥–∞—é—Ç—Å—è
```

**2. REDUCED_FEATURE:**
```
- SFTP –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
- Notifications –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã ‚Üí –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª
- Metrics –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã ‚Üí –±–∞–∑–æ–≤–æ–µ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```

**3. ESSENTIAL_ONLY:**
```
- –¢–æ–ª—å–∫–æ email processing + file conversion
- Health checks –æ—Ç–∫–ª—é—á–µ–Ω—ã
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
```

**4. MAINTENANCE_MODE:**
```
- Email processing –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –¢–æ–ª—å–∫–æ health checks —Ä–∞–±–æ—Ç–∞—é—Ç
- –í—Å–µ –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è
```

#### Automatic Fallback Strategies:

```python
# SFTP Fallback
if sftp_unavailable:
    save_files_locally("/backup/sftp_queue/")
    schedule_retry_when_available()

# Notifications Fallback
if telegram_unavailable:
    send_via_email()
if email_unavailable:
    log_to_file("/logs/notifications.log")

# Database Fallback
if database_unavailable:
    cache_operations_in_memory()
    persist_when_database_recovers()
```

### Recovery Mechanisms

#### Automatic Recovery:

```python
# Health Check Recovery
async def check_component_recovery():
    for component in failed_components:
        if await test_component_health(component):
            restore_component(component)
            log_recovery(component)
            send_recovery_notification(component)

# Retry Scheduling
@retry_with_exponential_backoff(
    max_attempts=3,
    base_delay=30,
    max_delay=300
)
async def retry_failed_operation():
    # –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
    pass
```

#### Manual Recovery Commands:

```bash
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å Circuit Breaker
curl -X POST http://localhost:8000/api/admin/circuit-breaker/reset

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
curl -X POST http://localhost:8000/api/admin/component/recover -d '{"component": "sftp"}'

# –û—á–∏—Å—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –æ—à–∏–±–æ–∫
curl -X DELETE http://localhost:8000/api/admin/error-queue
```

---

## üîå **API –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø**

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST API –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç interactive API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:

```bash
# Swagger UI
http://localhost:8000/docs

# ReDoc
http://localhost:8000/redoc

# OpenAPI JSON Schema
http://localhost:8000/openapi.json
```

### API Endpoints

#### Health Check Endpoints

**GET /health/live**
```yaml
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: Liveness probe –¥–ª—è Kubernetes
–û—Ç–≤–µ—Ç: 204 No Content (–µ—Å–ª–∏ –∂–∏–≤)
–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: < 100ms
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: kubectl, health checkers
```

**GET /health/ready**
```yaml
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: Readiness probe, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
–û—Ç–≤–µ—Ç—ã:
  - 204 No Content: –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–¥–æ—Ä–æ–≤—ã
  - 503 Service Unavailable: –ø—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
–ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: Database, SFTP, Email
–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: < 5 —Å–µ–∫—É–Ω–¥
```

**GET /health/detailed**
```yaml
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: JSON —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –û—Ç–ª–∞–¥–∫–∞, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, dashboards

–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
{
  "status": "healthy|degraded|unhealthy",
  "checked_at": "2025-01-30T12:00:00Z",
  "dependencies": {
    "database": {
      "status": "healthy",
      "response_time_ms": 15,
      "details": "Connection successful",
      "last_check": "2025-01-30T12:00:00Z"
    },
    "sftp": {
      "status": "unhealthy",
      "response_time_ms": null,
      "details": "Connection timeout",
      "error": "Failed to connect after 30s",
      "last_successful_check": "2025-01-30T11:45:00Z"
    },
    "email": {
      "status": "healthy",
      "response_time_ms": 234,
      "details": "IMAP connection successful",
      "mailbox_count": 1250
    }
  },
  "degradation_level": "reduced_feature",
  "active_fallbacks": ["sftp_local_storage"],
  "total_response_time_ms": 249
}
```

#### Monitoring Endpoints

**GET /metrics**
```yaml
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: Prometheus –º–µ—Ç—Ä–∏–∫–∏
–§–æ—Ä–º–∞—Ç: Prometheus exposition format
Content-Type: text/plain; version=0.0.4; charset=utf-8
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: Prometheus scraping, Grafana

–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
  - emails_processed_total
  - files_converted_total
  - sftp_uploads_total
  - errors_by_type_total
  - processing_duration_seconds
  - health_check_duration_seconds
  - active_processing_jobs
  - email_queue_size
  - last_successful_processing_timestamp
  - app_info
```

**GET /**
```yaml
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ö–æ—Ä–Ω–µ–≤–æ–π endpoint, –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
–û—Ç–≤–µ—Ç:
{
  "message": "Service is running, scheduler is active.",
  "service": "Email & SFTP Processor",
  "version": "1.0.0",
  "status": "healthy",
  "uptime_seconds": 3600,
  "next_scheduled_run": "2025-01-30T13:00:00Z"
}
```

#### Administrative API (–±—É–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏)

**POST /api/admin/processing/trigger**
```yaml
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏
–¢—Ä–µ–±—É–µ—Ç: Admin —Ç–æ–∫–µ–Ω
–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:
{
  "force": true,
  "specific_emails": ["email1@domain.com"]  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
}
```

**GET /api/admin/stats**
```yaml
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
–û—Ç–≤–µ—Ç:
{
  "processing_stats": {
    "total_emails_processed": 1500,
    "total_files_converted": 1200,
    "total_sftp_uploads": 1180,
    "success_rate": 0.985,
    "average_processing_time_ms": 4250
  },
  "error_stats": {
    "critical_errors": 2,
    "recoverable_errors": 45,
    "warning_errors": 123,
    "recovery_rate": 0.956
  },
  "system_stats": {
    "uptime_hours": 168,
    "memory_usage_mb": 256,
    "disk_usage_gb": 12.5,
    "cpu_usage_percent": 15.3
  }
}
```

### Rate Limiting

–í—Å–µ API endpoints –∑–∞—â–∏—â–µ–Ω—ã rate limiting:

```yaml
Default limits:
  - /health/*: 600 requests/minute (10/second)
  - /metrics: 60 requests/minute (1/second)
  - /api/*: 100 requests/minute (1.67/second)
  - Other endpoints: 100 requests/minute

Rate limit headers:
  - X-RateLimit-Limit: Maximum requests
  - X-RateLimit-Remaining: Remaining requests
  - X-RateLimit-Reset: Reset time (Unix timestamp)

Rate limit exceeded response:
  - Status: 429 Too Many Requests
  - Body: {"error": "Rate limit exceeded. Please try again later."}
  - Header: Retry-After: 60
```

### API Client Examples

#### Python client:
```python
import requests
import time

class EmailProcessorClient:
    def __init__(self, base_url="http://localhost:8000"):
        self.base_url = base_url

    def check_health(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã"""
        response = requests.get(f"{self.base_url}/health/detailed")
        return response.json()

    def get_metrics(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ Prometheus"""
        response = requests.get(f"{self.base_url}/metrics")
        return response.text

    def wait_for_ready(self, timeout=300):
        """–û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã"""
        start_time = time.time()
        while time.time() - start_time < timeout:
            try:
                response = requests.get(f"{self.base_url}/health/ready")
                if response.status_code == 204:
                    return True
            except requests.RequestException:
                pass
            time.sleep(10)
        return False

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
client = EmailProcessorClient()
if client.wait_for_ready():
    health = client.check_health()
    print(f"System status: {health['status']}")
```

#### Bash client:
```bash
#!/bin/bash
# Email Processor API Client

BASE_URL="http://localhost:8000"

check_health() {
    curl -s "$BASE_URL/health/detailed" | jq -r '.status'
}

get_metrics() {
    curl -s "$BASE_URL/metrics" | grep -E "^(emails_processed|files_converted|sftp_uploads)_total"
}

wait_for_ready() {
    local timeout=${1:-300}
    local elapsed=0

    while [ $elapsed -lt $timeout ]; do
        if curl -s -o /dev/null -w "%{http_code}" "$BASE_URL/health/ready" | grep -q "204"; then
            echo "System is ready"
            return 0
        fi
        sleep 10
        elapsed=$((elapsed + 10))
    done

    echo "Timeout waiting for system to be ready"
    return 1
}

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
if wait_for_ready; then
    echo "Health status: $(check_health)"
    echo "Key metrics:"
    get_metrics
fi
```

---

## üîí **–ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨**

### –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### 1. **Authentication & Authorization**

**SSH Key-based Authentication –¥–ª—è SFTP:**
```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è secure –∫–ª—é—á–µ–π
ssh-keygen -t rsa -b 4096 -f ~/.ssh/sftp_key

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö permissions
chmod 600 ~/.ssh/sftp_key
chmod 644 ~/.ssh/sftp_key.pub

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ docker-compose.yml
volumes:
  - ~/.ssh/sftp_key:/root/.ssh/id_rsa:ro
```

**Email Authentication:**
```yaml
# App-specific passwords –¥–ª—è Gmail
email:
  username: "service-account@company.com"
  password: "app-specific-password"  # –ù–ï –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä–æ–ª—å!

# OAuth2 –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö email (–±—É–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏)
oauth2:
  client_id: "${EMAIL_CLIENT_ID}"
  client_secret: "${EMAIL_CLIENT_SECRET}"
  tenant_id: "${EMAIL_TENANT_ID}"
```

#### 2. **Network Security**

**Container Network Isolation:**
```yaml
# docker-compose.yml
networks:
  backend:
    driver: bridge
    internal: true  # –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –≤–Ω–µ—à–Ω–µ–π —Å–µ—Ç–∏
  frontend:
    driver: bridge

services:
  app:
    networks:
      - backend
      - frontend
  db:
    networks:
      - backend  # –¢–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å
```

**Firewall Rules (iptables):**
```bash
# –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã
iptables -A INPUT -p tcp --dport 8000 -j ACCEPT  # API
iptables -A INPUT -p tcp --dport 22 -j ACCEPT    # SSH
iptables -A INPUT -p tcp --dport 443 -j ACCEPT   # HTTPS

# –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ
iptables -A INPUT -j DROP
```

#### 3. **Data Security**

**Encryption at Rest:**
```yaml
# PostgreSQL —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º
db:
  environment:
    POSTGRES_INITDB_ARGS: "--auth-host=scram-sha-256"
  volumes:
    - type: volume
      source: postgres_data
      target: /var/lib/postgresql/data
      volume:
        driver_opts:
          type: "encrypted"
```

**Encryption in Transit:**
```yaml
# TLS –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
email:
  use_tls: true
  verify_cert: true

sftp:
  strict_host_key_checking: true

notifications:
  email:
    use_tls: true
  telegram:
    verify_ssl: true
```

#### 4. **Secrets Management**

**Environment Variables Security:**
```bash
# .env —Ñ–∞–π–ª —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ permissions
touch .env
chmod 600 .env  # –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å

# Docker secrets (production)
echo "password123" | docker secret create postgres_password -
```

**Vault Integration (production):**
```python
# config/vault_config.py
import hvac

class VaultConfig:
    def __init__(self):
        self.client = hvac.Client(url='https://vault.company.com')

    def get_secret(self, path):
        response = self.client.secrets.kv.v2.read_secret_version(path=path)
        return response['data']['data']

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
vault = VaultConfig()
db_creds = vault.get_secret('email-processor/database')
```

#### 5. **Rate Limiting & DDoS Protection**

**Multi-tier Rate Limiting:**
```python
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ endpoints
RATE_LIMITS = {
    "/health/*": {
        "requests_per_minute": 600,  # Health checks
        "strategy": "fixed_window"
    },
    "/metrics": {
        "requests_per_minute": 60,   # Prometheus scraping
        "strategy": "sliding_window"
    },
    "/api/*": {
        "requests_per_minute": 100,  # API calls
        "strategy": "token_bucket",
        "burst_allowance": 20
    }
}
```

**IP-based Blocking:**
```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö IP
SECURITY_RULES = {
    "block_threshold": 1000,      # –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ —á–∞—Å
    "block_duration": 3600,       # –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ —á–∞—Å
    "whitelist_ips": [
        "10.0.0.0/8",            # –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å
        "192.168.1.100"          # Monitoring —Å–µ—Ä–≤–µ—Ä
    ]
}
```

### Performance Optimization

#### 1. **Database Performance**

**Connection Pooling:**
```yaml
database:
  pool_size: 20                 # –û—Å–Ω–æ–≤–Ω–æ–π –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
  max_overflow: 30              # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
  pool_timeout: 30              # –¢–∞–π–º–∞—É—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
  pool_recycle: 3600            # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (1 —á–∞—Å)
  pool_pre_ping: true           # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
```

**–ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```sql
-- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
CREATE INDEX CONCURRENTLY idx_processed_files_message_id
    ON processed_files(message_id);

CREATE INDEX CONCURRENTLY idx_processed_files_processed_at
    ON processed_files(processed_at DESC);

CREATE INDEX CONCURRENTLY idx_operation_logs_created_at
    ON operation_logs(created_at DESC);

CREATE INDEX CONCURRENTLY idx_operation_logs_operation_type
    ON operation_logs(operation_type, status);
```

**Query Optimization:**
```python
# Efficient queries —Å –ª–∏–º–∏—Ç–∞–º–∏
async def get_recent_files(limit: int = 100):
    query = select(ProcessedFile).order_by(
        ProcessedFile.processed_at.desc()
    ).limit(limit)
    return await session.execute(query)

# Batch –æ–ø–µ—Ä–∞—Ü–∏–∏
async def bulk_insert_logs(logs: List[OperationLog]):
    await session.execute(
        insert(OperationLog),
        [log.dict() for log in logs]
    )
```

#### 2. **Memory Optimization**

**Streaming File Processing:**
```python
# –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –ø–æ —á–∞—Å—Ç—è–º
async def process_large_file(file_path: Path):
    chunk_size = 10000  # —Å—Ç—Ä–æ–∫

    async with aiofiles.open(file_path, 'rb') as f:
        for chunk in pd.read_excel(f, chunksize=chunk_size):
            processed_chunk = await process_chunk(chunk)
            await save_chunk_to_csv(processed_chunk)

            # –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
            del chunk, processed_chunk
            gc.collect()
```

**Memory Monitoring:**
```python
import psutil
import asyncio

async def monitor_memory():
    process = psutil.Process()

    while True:
        memory_mb = process.memory_info().rss / 1024 / 1024

        if memory_mb > 500:  # MB
            logger.warning(f"High memory usage: {memory_mb:.1f}MB")
            gc.collect()  # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞

        await asyncio.sleep(60)
```

#### 3. **Async Optimization**

**Connection Pooling –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:**
```python
# SFTP Connection Pool
class SFTPConnectionPool:
    def __init__(self, max_connections=5):
        self.pool = asyncio.Queue(maxsize=max_connections)
        self.max_connections = max_connections

    async def get_connection(self):
        try:
            return await asyncio.wait_for(
                self.pool.get(),
                timeout=30
            )
        except asyncio.TimeoutError:
            return await self.create_connection()
```

**Parallel Processing:**
```python
# –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤
async def process_multiple_files(files: List[Path]):
    semaphore = asyncio.Semaphore(3)  # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ concurrent –æ–ø–µ—Ä–∞—Ü–∏–π

    async def process_single_file(file_path):
        async with semaphore:
            return await process_file(file_path)

    tasks = [process_single_file(f) for f in files]
    results = await asyncio.gather(*tasks, return_exceptions=True)

    return results
```

#### 4. **Caching Strategy**

**Redis Caching (–¥–ª—è production):**
```python
import aioredis

class CacheService:
    def __init__(self):
        self.redis = aioredis.from_url("redis://localhost:6379")

    async def cache_file_hash(self, file_path: str, hash_value: str):
        await self.redis.setex(
            f"file_hash:{file_path}",
            3600,  # TTL 1 —á–∞—Å
            hash_value
        )

    async def get_cached_hash(self, file_path: str) -> Optional[str]:
        return await self.redis.get(f"file_hash:{file_path}")
```

**In-Memory Caching:**
```python
from functools import lru_cache
import time

class InMemoryCache:
    def __init__(self, ttl=300):  # 5 –º–∏–Ω—É—Ç TTL
        self.cache = {}
        self.ttl = ttl

    def get(self, key):
        if key in self.cache:
            value, timestamp = self.cache[key]
            if time.time() - timestamp < self.ttl:
                return value
            else:
                del self.cache[key]
        return None

    def set(self, key, value):
        self.cache[key] = (value, time.time())
```

### Resource Monitoring

#### System Resource Monitoring:

```python
# Continuous resource monitoring
async def monitor_system_resources():
    while True:
        # CPU Usage
        cpu_percent = psutil.cpu_percent(interval=1)

        # Memory Usage
        memory = psutil.virtual_memory()
        memory_percent = memory.percent

        # Disk Usage
        disk = psutil.disk_usage('/')
        disk_percent = (disk.used / disk.total) * 100

        # Network I/O
        network = psutil.net_io_counters()

        # Log –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω—ã –ø–æ—Ä–æ–≥–∏
        if cpu_percent > 80:
            logger.warning(f"High CPU usage: {cpu_percent}%")

        if memory_percent > 85:
            logger.warning(f"High memory usage: {memory_percent}%")

        if disk_percent > 90:
            logger.error(f"High disk usage: {disk_percent}%")

        # –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è Prometheus
        await update_system_metrics(cpu_percent, memory_percent, disk_percent)

        await asyncio.sleep(30)
```

#### Performance Benchmarks:

```python
# Benchmark —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è —Å–∏—Å—Ç–µ–º—ã
PERFORMANCE_TARGETS = {
    "email_check_duration": "< 30 seconds",
    "file_conversion_rate": "> 10 MB/second",
    "sftp_upload_rate": "> 5 MB/second",
    "database_query_time": "< 100ms",
    "health_check_response": "< 1 second",
    "memory_usage": "< 512 MB",
    "cpu_usage": "< 50% average"
}
```

---

## üîß **–£–°–¢–†–ê–ù–ï–ù–ò–ï –ù–ï–ü–û–õ–ê–î–û–ö**

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

#### 1. **–°–∏—Å—Ç–µ–º–∞ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**

**–ü—Ä–æ–±–ª–µ–º–∞:** Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ —Å—Ç–∞—Ä—Ç—É—é—Ç
```bash
# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
docker-compose ps
docker-compose logs app

# –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
# 1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ permissions –Ω–∞ .env —Ñ–∞–π–ª–µ
chmod 600 .env

# 2. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
grep -v '^#\|^$' .env  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

# 3. –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤
netstat -tulpn | grep :8000

# 4. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
df -h
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è PostgreSQL
docker-compose exec db pg_isready -U $POSTGRES_USER

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –ë–î
docker-compose logs db

# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –¥–∞–Ω–Ω—ã–º–∏
docker-compose down
docker volume prune  # –í–ù–ò–ú–ê–ù–ò–ï: —É–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ!
docker-compose up -d
```

#### 2. **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ Email**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ IMAP
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
telnet imap.gmail.com 993

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ IMAP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
python3 -c "
import imaplib
try:
    mail = imaplib.IMAP4_SSL('imap.gmail.com', 993)
    mail.login('$EMAIL_USER', '$EMAIL_PASS')
    print('IMAP connection successful')
    mail.logout()
except Exception as e:
    print(f'IMAP connection failed: {e}')
"
```

**–¢–∏–ø–∏—á–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è App-specific password, –∞ –Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä–æ–ª—å
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–∫–ª—é—á–µ–Ω–∞ 2FA –≤ Google Account
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ "Less secure app access" –≤—ã–∫–ª—é—á–µ–Ω (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ App passwords)

#### 3. **–ü—Ä–æ–±–ª–µ–º—ã —Å–æ SFTP**

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ SFTP
```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ SFTP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
sftp -i ~/.ssh/id_rsa -P 2222 sftpuser@localhost

# –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –∫–ª—é—á–µ–π
ssh-keygen -y -f ~/.ssh/id_rsa  # –î–æ–ª–∂–µ–Ω –≤—ã–≤–µ—Å—Ç–∏ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á

# –ü—Ä–æ–≤–µ—Ä–∫–∞ permissions
ls -la ~/.ssh/
# id_rsa –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 600, id_rsa.pub –º–æ–∂–µ—Ç –±—ã—Ç—å 644
```

**–¢–∏–ø–∏—á–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ permissions (600)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ SFTP —Å–µ—Ä–≤–µ—Ä
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–µ–π (OpenSSH vs PEM)

#### 4. **–ü—Ä–æ–±–ª–µ–º—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ñ–∞–π–ª–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞:** –§–∞–π–ª—ã –Ω–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
docker-compose logs app | grep file_processor

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é
docker-compose exec app python -c "
import pandas as pd
df = pd.read_excel('/path/to/test.xlsx')
df.to_csv('/tmp/test.csv', index=False, encoding='utf-8-sig')
print('Conversion successful')
"
```

**–¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ Excel —Ñ–∞–π–ª—ã
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –ø–∞–º—è—Ç–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞

#### 5. **Performance Issues**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ —Ñ–∞–π–ª–æ–≤
find storage/ -name "*.xlsx" -exec ls -lh {} \;

# –ê–Ω–∞–ª–∏–∑ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ë–î
docker-compose exec db psql -U $POSTGRES_USER -d $POSTGRES_DB -c "
SELECT query, mean_time, calls
FROM pg_stat_statements
ORDER BY mean_time DESC
LIMIT 10;"
```

### –û–±—â–∏–µ –∫–æ–º–∞–Ω–¥—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

#### System Health Check:
```bash
#!/bin/bash
# comprehensive_health_check.sh

echo "=== Email Processor Health Check ==="

# 1. Container Status
echo "1. Container Status:"
docker-compose ps

# 2. Resource Usage
echo -e "\n2. Resource Usage:"
docker stats --no-stream

# 3. Disk Space
echo -e "\n3. Disk Space:"
df -h

# 4. API Health
echo -e "\n4. API Health:"
curl -s http://localhost:8000/health/detailed | jq -r '.status'

# 5. Database Status
echo -e "\n5. Database Connection:"
docker-compose exec -T db pg_isready -U $POSTGRES_USER

# 6. SFTP Test
echo -e "\n6. SFTP Test:"
timeout 10 sftp -i ~/.ssh/id_rsa -P 2222 sftpuser@localhost <<< "ls" 2>/dev/null && echo "SFTP OK" || echo "SFTP Failed"

# 7. Recent Errors
echo -e "\n7. Recent Errors (last 10):"
docker-compose logs app --tail=100 | grep ERROR | tail -10

echo -e "\nHealth check completed."
```

#### Log Analysis:
```bash
#!/bin/bash
# analyze_logs.sh

echo "=== Log Analysis ==="

# Error summary
echo "1. Error Summary (last 24 hours):"
docker-compose logs app --since 24h | grep ERROR | awk '{print $5}' | sort | uniq -c | sort -nr

# Performance analysis
echo -e "\n2. Performance Analysis:"
docker-compose logs app --since 1h | grep "operation_completed" |
awk '{print $NF}' | sort -n |
awk '{
    if(NR==1) min=$1
    max=$1
    sum+=$1
}
END {
    print "Min:", min "ms"
    print "Max:", max "ms"
    print "Avg:", sum/NR "ms"
}'

# Success rate
echo -e "\n3. Success Rate (last hour):"
total=$(docker-compose logs app --since 1h | grep -c "processing_completed")
success=$(docker-compose logs app --since 1h | grep "processing_completed" | grep -c "success")
if [ $total -gt 0 ]; then
    echo "Success rate: $(echo "scale=2; $success * 100 / $total" | bc)% ($success/$total)"
else
    echo "No processing completed in the last hour"
fi
```

### Emergency Procedures

#### 1. **Service Recovery**
```bash
# –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
#!/bin/bash
echo "Starting emergency recovery..."

# 1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose down

# 2. Backup —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
docker run --rm -v rs-stoplist-project_postgres_data:/data -v $(pwd):/backup alpine tar czf /backup/postgres_backup_$(date +%Y%m%d_%H%M%S).tar.gz /data

# 3. –û—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ
docker system prune -f
docker-compose build --no-cache

# 4. –ó–∞–ø—É—Å–∫ —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
docker-compose up -d
sleep 30

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
curl -f http://localhost:8000/health/ready && echo "Service recovered successfully" || echo "Recovery failed"
```

#### 2. **Data Recovery**
```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup
#!/bin/bash
backup_file=$1

if [ -z "$backup_file" ]; then
    echo "Usage: $0 <backup_file>"
    exit 1
fi

echo "Restoring from backup: $backup_file"

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose stop

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
docker run --rm -v rs-stoplist-project_postgres_data:/data -v $(pwd):/backup alpine tar xzf /backup/$backup_file -C /

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose start

echo "Restore completed"
```

#### 3. **Performance Tuning**
```bash
# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
#!/bin/bash

echo "Applying performance optimizations..."

# 1. –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤
find logs/ -name "*.log" -mtime +7 -delete

# 2. Vacuum –ë–î
docker-compose exec db psql -U $POSTGRES_USER -d $POSTGRES_DB -c "VACUUM ANALYZE;"

# 3. –û—á–∏—Å—Ç–∫–∞ Docker
docker system prune -f

# 4. Restart —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose restart

echo "Performance optimization completed"
```

---

## ‚ùì **–ß–ê–°–¢–û –ó–ê–î–ê–í–ê–ï–ú–´–ï –í–û–ü–†–û–°–´**

### –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ö–∞–∫ —á–∞—Å—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–æ–≤—ã–µ email?**
A: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–∞–∂–¥—ã–π —á–∞—Å. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `config/config.yaml`:
```yaml
scheduler:
  interval_hours: 1  # –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ 0.5 (30 –º–∏–Ω) –∏–ª–∏ –ª—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
```

**Q: –ö–∞–∫–æ–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è?**
A: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 50MB. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```yaml
file_processing:
  max_file_size_mb: 50  # –£–≤–µ–ª–∏—á—å—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
```

**Q: –ú–æ–∂–Ω–æ –ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ñ–∞–π–ª—ã –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö email –∞–∫–∫–∞—É–Ω—Ç–æ–≤?**
A: –î–∞, –¥–æ–±–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
```yaml
email:
  accounts:
    - server: "imap.gmail.com"
      username: "${EMAIL_USER_1}"
      password: "${EMAIL_PASS_1}"
    - server: "imap.outlook.com"
      username: "${EMAIL_USER_2}"
      password: "${EMAIL_PASS_2}"
```

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –≤ whitelist?**
A: –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `config/config.yaml`:
```yaml
email:
  allowed_senders:
    - "existing@sender.com"
    - "new@sender.com"  # –î–æ–±–∞–≤–∏—Ç—å –∑–¥–µ—Å—å
```
–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏.

**Q: –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–Ω–æ–≥–æ CSV —Ñ–∞–π–ª–∞?**
A: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```yaml
file_processing:
  csv_encoding: "utf-8-sig"  # –∏–ª–∏ "utf-8", "cp1251"
  csv_separator: ","         # –∏–ª–∏ ";" –¥–ª—è Excel
  output_format: "RS_stoplist_{YYYYMMDD}.csv"
```

**Q: –ú–æ–∂–Ω–æ –ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å SFTP –∑–∞–≥—Ä—É–∑–∫—É –∏ —Ç–æ–ª—å–∫–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã?**
A: –î–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
DISABLE_SFTP_UPLOAD=true
```
–§–∞–π–ª—ã –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ.

### –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

**Q: –°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "Service Unavailable" –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ /health/ready**
A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
curl http://localhost:8000/health/detailed

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
docker-compose exec db pg_isready
sftp -i ~/.ssh/id_rsa -P 2222 sftpuser@localhost
```

**Q: –§–∞–π–ª—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è, –Ω–æ –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–∞ SFTP —Å–µ—Ä–≤–µ—Ä–µ**
A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–∞–π–ª–æ–≤:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ SFTP –æ–ø–µ—Ä–∞—Ü–∏–π
docker-compose logs app | grep sftp_uploader

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ SFTP —Å–µ—Ä–≤–µ—Ä–µ
sftp -i ~/.ssh/id_rsa user@sftp-server
ls -la /upload/directory/
```

**Q: –í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏**
A: –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤:
```yaml
file_processing:
  chunk_size: 10000      # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ —á–∞—Å—Ç—è–º
  max_file_size_mb: 20   # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞
  cleanup_temp_files: true
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

**Q: –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –≤ Grafana?**
A: –°–æ–∑–¥–∞–π—Ç–µ –∞–ª–µ—Ä—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç—Ä–∏–∫:
```json
{
  "alert": {
    "conditions": [
      {
        "query": "A",
        "reducer": "last",
        "type": "query"
      }
    ],
    "executionErrorState": "alerting",
    "for": "5m",
    "frequency": "10s",
    "handler": 1,
    "name": "Email Processing Failure",
    "noDataState": "no_data",
    "notifications": []
  },
  "targets": [
    {
      "expr": "rate(errors_by_type_total{severity=\"critical\"}[5m])",
      "refId": "A"
    }
  ]
}
```

**Q: –ö–∞–∫ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö?**
A: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Telegram/Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
```yaml
notifications:
  telegram:
    bot_token: "${TG_BOT_TOKEN}"
    chat_id: "${TG_CHAT_ID}"
    alert_levels: ["critical", "error"]  # –¢–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ
  email:
    recipients: ["admin@company.com"]
    alert_levels: ["critical"]  # –¢–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**Q: –ö–∞–∫ —É—Å–∫–æ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤?**
A: –ù–µ—Å–∫–æ–ª—å–∫–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:
```yaml
# 1. –£–≤–µ–ª–∏—á—å—Ç–µ –ø–∞–º—è—Ç—å –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
services:
  app:
    deploy:
      resources:
        limits:
          memory: 2G

# 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É
file_processing:
  parallel_workers: 3
  chunk_size: 50000

# 3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSD –¥–∏—Å–∫–∏ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
file_processing:
  temp_directory: "/tmp/fast_ssd/"
```

**Q: –ö–∞–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –¥–ª—è –±–æ–ª—å—à–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏?**
A: –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# 1. –ó–∞–ø—É—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤
docker-compose up -d --scale app=3

# 2. Load balancer (nginx)
upstream email_processor {
    server app:8000;
    server app:8000;
    server app:8000;
}

# 3. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ email –∞–∫–∫–∞—É–Ω—Ç–∞–º
# –ö–∞–∂–¥—ã–π –∏–Ω—Å—Ç–∞–Ω—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–≤–æ–π –Ω–∞–±–æ—Ä –∞–∫–∫–∞—É–Ω—Ç–æ–≤
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**Q: –ö–∞–∫ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ production?**
A: –°–ª–µ–¥—É–π—Ç–µ security checklist:
```bash
# 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS
server {
    listen 443 ssl;
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
}

# 2. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ API
iptables -A INPUT -p tcp --dport 8000 -s 10.0.0.0/8 -j ACCEPT
iptables -A INPUT -p tcp --dport 8000 -j DROP

# 3. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
docker-compose pull
docker-compose build --no-cache

# 4. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
docker scan email-processor:latest
```

**Q: –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?**
A: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ external secrets:
```yaml
# docker-compose.prod.yml
services:
  app:
    secrets:
      - postgres_password
      - email_password

secrets:
  postgres_password:
    external: true
  email_password:
    external: true
```

---

## üìû **–ü–û–î–î–ï–†–ñ–ö–ê –ò –ö–û–ù–¢–ê–ö–¢–´**

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–£—Ä–æ–≤–µ–Ω—å 1 - –°–∞–º–æ–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ:**
- –î–∞–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ health checks: `/health/detailed`
- –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: `docker-compose logs app`
- –ú–µ—Ç—Ä–∏–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: `/metrics`

**–£—Ä–æ–≤–µ–Ω—å 2 - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
- –ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
- –ê–Ω–∞–ª–∏–∑ performance –º–µ—Ç—Ä–∏–∫
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã

**–£—Ä–æ–≤–µ–Ω—å 3 - Escalation:**
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ —Å–∏—Å—Ç–µ–º—ã
- –ü—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### –û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å –æ–± –æ—à–∏–±–∫–∞—Ö

–ü—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–ª–æ–∂–∏—Ç–µ:

1. **System Information:**
```bash
# –°–æ–±–µ—Ä–∏—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
./scripts/collect_system_info.sh > system_info.txt
```

2. **Logs Package:**
```bash
# –°–æ–±–µ—Ä–∏—Ç–µ –ª–æ–≥–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
docker-compose logs --since 24h > logs_24h.txt
```

3. **Configuration:**
```bash
# –°–æ–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (—É–¥–∞–ª–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã!)
cp config/config.yaml config_anonymized.yaml
sed -i 's/password:.*/password: [REDACTED]/' config_anonymized.yaml
```

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ä–µ—Å—É—Ä—Å—ã

- **API Documentation:** http://localhost:8000/docs
- **Monitoring Dashboard:** http://localhost:3000 (Grafana)
- **Database Admin:** http://localhost:8080 (Adminer)

### –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –≤–µ—Ä—Å–∏–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏:**
```bash
curl http://localhost:8000/ | jq -r '.version'
```

**–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
- v1.1.0: OAuth2 –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö email
- v1.2.0: Web UI –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
- v1.3.0: Kubernetes Helm charts
- v2.0.0: –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

---

**¬© 2025 –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ Excel-—Ñ–∞–π–ª–æ–≤**
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** 1.0
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 30 —è–Ω–≤–∞—Ä—è 2025 –≥.
